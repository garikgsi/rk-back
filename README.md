## О проекте

Разработка Backend для сервиса Родительский комитет
Сайт и демо - https://rk.tcu.su
(frontend https://github.com/garikgsi/rk-front)

## Техническое задание
Разработать серверную часть API для хранения/модификации произвольного количества данных, произвольных таблиц, поиска, паджинации, необходимой для работы сервиса. Реализовать возможность регистрации только по приглашению. Реализовать возможность хранения демо-данных без возможности их модернизации, а также ограничить демо-пользователя просмотром данных и запретить инициировать регистрационные действия со своей стороны. В качестве идентификации пользователей использовать электронную почту. Ограничить количество запросов авторизации/регистрации, а также срок действия одноразовых кодов в целях информационной безопасности.

### Запросы авторизации/регистрации
    POST api/v1/auth/token - получить токен передав логин/пароль
    POST api/v1/auth/register - регистрация нового пользователя
    POST api/v1/auth/confirm_registration - подтверждение регистрации (подтверждение email)
    POST api/v1/auth/new_code - получение нового одноразового кода для совершения регистрационных действий
    POST api/v1/auth/restore_password - восстановление пароля
    GET api/v1/auth/user - получить информацию о текущем пользователе
    GET api/v1/auth/tokens - получить все токены текущего пользователя
    POST api/v1/auth/tokens - создать новый токен для текущего пользователя
    DELETE api/v1/auth/tokens - отозвать все токены у текущего пользователя
    DELETE api/v1/auth/tokens/{id} - отозвать токены c id у текущего пользователя
    POST api/v1/auth/invite - отправить приглашение новому пользователю (регистрация нового пользователя через приглашение)
### Запросы для получения публичных данных
    GET api/v1/public/{slug}/{period_id?} - получить отчет для учреждения (slug) и периода (period_id). Если период не указан - вернуть отчет для текущего
### Запросы для получения/модификации данных
    GET api/v1/public/table - получить N строк из таблицы table (N по умолчанию ==10 )
    GET api/v1/public/table/{id} - получить запись из таблицы table с id=={id}
    POST api/v1/public/table - добавить запись в таблицу table
    POST api/v1/public/table/{id} - скопировать запись в таблице table на основе записи с id=={id}
    PUT api/v1/public/table/{id} - обновить строку в таблице table с id=={id}
    PATCH api/v1/public/table/{id} - изменить только переданные поля в записи таблицы table с id=={id}
    DELETE api/v1/public/table/{id} - удалить запись из таблицы table с id=={id}
### Поиск
    GET api/v1/{table}?filter={fieldName} {exp} {values} {and|or} {fieldName2} {exp} {values} - поиск в таблице table, где 

    В поисковом запросе допускается указание нескольких полей выборки, объединенных логическими условиями and или or. Наличие скобок для указания приоритета условий недопускается.

    fieldName, fieldName2 - поля, по которым осуществляется поиск
    exp - логическое выражение:

        eq - равно
        ne - не равно
        like - содержит (аналог регистронезависимого поиска LIKE в SQL)
        in - содержит в массиве (аналог WHERE IN в SQL)
        ni - обратное от in (NOT IN)
        gt - больше
        gte - больше или равно
        lt - меньше
        lte - меньше или равно

    Например, 
    
    api/v1/{table}?filter=date_operation gt 2022-01-01 and id in [1001,1002,1003, 1004,1005] and amount gte 800 and comment like учебник
    
    выдаст строки из таблицы opeations (расходные операции), в которых дата операции больше 01.01.2022 и id равно одному из значений 1001,1002,1003,1004,1005 и сумма операции больше 800 и в комментарии содержится слово "учебник"

### Сортировка
    GET api/v1/{table}?sort={fieldName}.{asc|desc},{fieldName}.{asc|desc}

    API реализует множественную сортировку, для указания направление сортировки используется точечная нотация. Поля для сортировки передаются через запятую. Прямую сортировку (asc) можно не указывать.

    Например,

    /api/v1/operations?sort=date_operation.desc,price

    выдаст список из таблицы operations (расходные операции), отсортированный сначала по дате операции в обратном направлении (по убыванию), и потом по возрастанию цены в рамках одного дня

### Постраничная разбивка
    Постраничная разбивка включена по умолчанию. Без параметров выводится 10 строк и в ответе (поле count) передается общее количество строк, соответствующих выборке. Для ограничения количества получаемых строк можно применять как страничный режим - указывается количество строк на страницу и номер страницы, так и произвольное количество - указывается смещение и количество строк.   
#### Постраничная разбивка с указанием смещения и количества строк
    GET api/v1/{table}?limit={rowsLimit}&offset={skipRows}

        rowsLimit - количество ввыдаваемых строк
        skipRows - количество игнорируемых строк (смещение с начала списка), по умолчанию - 0

     Например,

     /api/v1/operations?offset=5&limit=5

    пропустит 2 записи с начала списка и выдаст 5 строк из таблицы operations (расходные операции)

#### Постраничная разбивка с указанием страницы и количества строк на страницы
    GET api/v1/{table}?offset={skipRows}&page={pageNum}&rows={rowsPerPage}

        skipRows - количество игнорируемых строк (смещение с начала списка), по умолчанию - 0
        pageNum - номер страницы
        rowsPerPage - кол-во строк на странице

    В страничном режиме возможно также указание смещения, при этом сначала обрабатывается смещение, а потом сервер выдает строки нужной страницы
    
    Например,

    /api/v1/operations?offset=2&page=2&rows=5

    пропустит 2 записи с начала списка, разобъет оставшийся результат на страницы по 5 строк и выдаст 2-ю страницу из таблицы operations (расходные операции)

## Время разработки API

Без бизнес-логики - согласно трекеру: TOTAL HOURS 15:30:45

## Качество кода

Общее покрытие тестами, согласно данным phpunit coverage - 87.2%, покрытие тестами собственного кода - 95%

## Примененные технологии

PHP 8.0 | Composer | MVC | PHPUnit | Git | MySql
Laravel9: Service | Facade | Eloquent | Route | Auth | Middleware | Validation | Exceptions
